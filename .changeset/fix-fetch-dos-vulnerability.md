---
"@pnpm/fetch": minor
"@pnpm/tarball-fetcher": minor
"@pnpm/npm-resolver": minor
---

Fixed a severe Denial of Service (DoS) vulnerability caused by unbounded memory allocation when fetching data from remote servers.

Previously, pnpm would buffer entire HTTP response bodies into memory without enforcing a maximum size limit. A malicious server could exploit this by streaming an infinite amount of data, causing the host machine to exhaust all physical RAM and swap space.

Now, both tarball fetching (default limit: 512 MB) and metadata fetching (default limit: 50 MB) enforce maximum body size limits. If a response exceeds the limit, pnpm immediately throws a `ResponseBodyTooLargeError` and stops downloading.

The fix includes:
- Early rejection when `Content-Length` header indicates response is too large
- Streaming size check during download to protect against missing or lying headers
- New helper functions `readBodyWithLimit` and `readJsonWithLimit` in `@pnpm/fetch`
